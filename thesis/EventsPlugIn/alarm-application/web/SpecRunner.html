<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Alarm application test runner</title>

		<link rel="shortcut icon" type="image/png" href="lib/jasmine-1.2.0/jasmine_favicon.png">
		<link rel="stylesheet" type="text/css" href="lib/jasmine-1.2.0/jasmine.css">
		<script type="text/javascript" src="lib/jasmine-1.2.0/jasmine.js"></script>
		<script type="text/javascript" src="lib/jasmine-1.2.0/jasmine-html.js"></script>

		<script type="text/javascript" src="lib/jWebSocket-1.0/jWebSocket.js"></script>
		<script type="text/javascript" src="lib/jWebSocket-1.0/jwsCache.js"></script>
		<script type="text/javascript" src="lib/jWebSocket-1.0/jwsEventsPlugIn.js"></script>

		<!-- include source files here... -->
		<script type="text/javascript" src="spec/AlarmSpec.js"></script>

		<script type="text/javascript">
			(function() {
				jws.serverConn = new jws.jWebSocketJSONClient();
				jws.serverConn.open(jws.JWS_SERVER_URL, {
					OnWelcome: function (){
						//Creating the filter chain
						var securityFilter = new jws.SecurityFilter();
						securityFilter.OnNotAuthorized = function(aEvent){
							//"Not Authorized" application global callback!
						}
			
						var cacheFilter = new jws.CacheFilter();
						cacheFilter.cache = new Cache();
						var validatorFiler = new jws.ValidatorFilter();
			
						//Creating the event notifier
						var notifier = new jws.EventsNotifier();
						notifier.ID = "alarmNotifier";
						notifier.NS = "alarm";
						notifier.jwsClient = jws.serverConn;
						notifier.filterChain = [securityFilter, cacheFilter, validatorFiler];
						notifier.initialize();
			  
						//Creating a plugin generator
						var generator = new jws.EventsPlugInGenerator();
						jws.alarmApp = {};

						//Generating the auth & alarm client plug-ins.
						jws.alarmApp.authPlugIn = generator.generate("auth", notifier, function(){
							jws.alarmApp.alarmPlugIn = generator.generate("alarm", notifier, function(){
		
								var jasmineEnv = jasmine.getEnv();
								jasmineEnv.updateInterval = 1000;

								var htmlReporter = new jasmine.HtmlReporter();

								jasmineEnv.addReporter(htmlReporter);

								jasmineEnv.specFilter = function(spec) {
									return htmlReporter.specFilter(spec);
								};

								execJasmine();

								function execJasmine() {
									jasmineEnv.execute();
								}
							});
						});
					},
					OnClose: function(){
						alert( "You are not connected to the server!" );
					}
				});

     

			})();
		</script>

	</head>

	<body>
	</body>
</html>
